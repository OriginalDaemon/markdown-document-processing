name: Test End to End
on:
  workflow_run:
    workflows: ['Update Beta Tag']
    types:
      - completed
jobs:
  format_test_docs_github_style:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    name: Package the test documentation using the github style and upload it as an artifact.
    steps:
      - uses: actions/checkout@v4
      - name: Process test/docs in confluence style
        id: process-github
        uses: originaldaemon/markdown-documentation-formatter@beta
        with:
          input: './tests/data/docs'
          output: './tests/data/processed_github'
          style: 'github'
          args: '--version test'
      - name: Upload processed as artifact
        uses: actions/upload-artifact@v4
        with:
          name: 'processed_github'
          path: ${{ steps.process-github.outputs.processed }}
      - name: Validate result
        uses: originaldaemon/markdown-documentation-formatter@beta
        with:
          input: ${{ steps.process-github.outputs.processed }}
          style: 'github'
          validate: true
          args: '--version test'
  format_test_docs_confluence_style:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    name: Package the test documentation using the confluence style and upload it as an artifact.
    outputs:
      processed: ${{ steps.process-confluence.outputs.processed }}
    steps:
      - uses: actions/checkout@v4
      - name: Process test/docs in confluence style
        id: process-confluence
        uses: originaldaemon/markdown-documentation-formatter@beta
        with:
          input: './tests/data/docs'
          output: './tests/data/processed_confluence'
          style: 'confluence'
          args: '--version test'
      - name: Upload processed as artifact
        uses: actions/upload-artifact@v4
        with:
          name: 'processed_confluence'
          path: ${{ steps.process-confluence.outputs.processed }}
  validate_test_docs_confluence_style:
    runs-on: ubuntu-latest
    needs: format_test_docs_confluence_style
    name: Validate the documentation processed in format_test_docs_confluence_style.
    steps:
      - uses: actions/checkout@v4
      - name: Dowwnload processed as artifact
        uses: actions/download-artifact@v4
        with:
          name: 'processed_confluence'
          path: ${{ needs.format_test_docs_confluence_style.outputs.processed }}
      - name: Validate result
        uses: originaldaemon/markdown-documentation-formatter@beta
        with:
          input: ${{ needs.format_test_docs_confluence_style.outputs.processed }}
          validate: true
          style: 'confluence'
          args: '--version test'
