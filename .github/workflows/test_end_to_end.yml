name: Test End to End
on:
  push:
    tags:
      - 'v[0-9]'
      - 'latest'
      - 'stable'
jobs:
  process_docs_confluence_style:
    runs-on: ubuntu-latest
    name: Test Formatting - Confluence Style.
    steps:
      - uses: actions/checkout@v4
      - name: Process test/docs in confluence style
        id: process-confluence
        uses: originaldaemon/markdown-documentation-formatter@${{ github.ref_name }}
        with:
          input: './tests/data/docs'
          output: './tests/data/processed_confluence'
          style: 'confluence'
          args: '--version test'
      - name: Validate result
        if: steps.process-confluence.outcome == 'success'
        uses: originaldaemon/markdown-documentation-formatter@${{ github.ref_name }}
        with:
          input: ${{ steps.process-confluence.outputs.processed }}
          validate: true
          style: 'confluence'
          args: '--version test'
      - name: Upload processed as artifact
        if: steps.process-confluence.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: 'processed_confluence'
          path: ${{ steps.process-confluence.outputs.processed }}
  process_docs_github_style:
    runs-on: ubuntu-latest
    name: Test Formatting - GitHub Style.
    steps:
      - uses: actions/checkout@v4
      - name: Process test/docs in github style
        id: process-github
        uses: originaldaemon/markdown-documentation-formatter@${{ github.ref }}
        with:
          input: './tests/data/docs'
          output: './tests/data/processed_github'
          style: 'github'
          args: '--version test'
      - name: Validate result
        if: steps.process-github.outcome == 'success'
        uses: originaldaemon/markdown-documentation-formatter@${{ github.ref }}
        with:
          input: ${{ steps.process-github.outputs.processed }}
          validate: true
          style: 'github'
          args: '--version test'
      - name: Upload processed as artifact
        if: steps.process-github.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: 'processed_github'
          path: ${{ steps.process-github.outputs.processed }}
